<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spark Deployment Verification</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #0a0e27;
      color: #14f195;
      padding: 20px;
      line-height: 1.6;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border: 2px solid;
      border-radius: 4px;
    }
    .pass { border-color: #14f195; background: rgba(20, 241, 149, 0.1); }
    .fail { border-color: #ff1493; background: rgba(255, 20, 147, 0.1); }
    .warning { border-color: #ffaa00; background: rgba(255, 170, 0, 0.1); }
    code { background: rgba(0, 0, 0, 0.3); padding: 2px 6px; border-radius: 3px; }
    pre { background: rgba(0, 0, 0, 0.5); padding: 15px; border-radius: 5px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üîç Spark Deployment Verification</h1>
  <p>This page helps diagnose if Spark is serving the correct built files.</p>
  
  <div id="results"></div>
  
  <script>
    const results = document.getElementById('results');
    
    function addResult(title, status, message, details = '') {
      const div = document.createElement('div');
      div.className = `status ${status}`;
      div.innerHTML = `
        <strong>${title}</strong><br>
        ${message}
        ${details ? `<pre>${details}</pre>` : ''}
      `;
      results.appendChild(div);
    }
    
    // Check 1: Script tag analysis
    const scripts = Array.from(document.querySelectorAll('script[type="module"]'));
    const mainScript = scripts.find(s => s.src.includes('index-') || s.src.includes('main'));
    
    if (mainScript) {
      if (mainScript.src.includes('/assets/index-') && mainScript.src.includes('.js')) {
        addResult('‚úÖ Script Tag', 'pass', 
          'CORRECT: Found compiled script with hash',
          `Script: ${mainScript.src}`);
      } else if (mainScript.src.includes('/src/main.tsx')) {
        addResult('‚ùå Script Tag', 'fail',
          'WRONG: Found TypeScript source file',
          `Script: ${mainScript.src}\n\nThis means Spark is serving source index.html, not dist/index.html!\n\nFix: Configure Spark to serve from dist/ directory.`);
      } else {
        addResult('‚ö†Ô∏è Script Tag', 'warning',
          'UNKNOWN: Unexpected script path',
          `Script: ${mainScript.src}`);
      }
    } else {
      addResult('‚ùå Script Tag', 'fail',
        'ERROR: No module script found',
        'React will never load. Check if index.html is being served correctly.');
    }
    
    // Check 2: Asset directory
    const linkTags = Array.from(document.querySelectorAll('link[rel="modulepreload"], link[rel="stylesheet"]'));
    const assetLinks = linkTags.filter(l => l.href.includes('/assets/'));
    
    if (assetLinks.length > 0) {
      addResult('‚úÖ Asset Links', 'pass',
        `Found ${assetLinks.length} asset links pointing to /assets/ directory`,
        assetLinks.slice(0, 5).map(l => l.href).join('\n'));
    } else {
      addResult('‚ö†Ô∏è Asset Links', 'warning',
        'No asset links found - may indicate source HTML is being served');
    }
    
    // Check 3: Root element
    const root = document.getElementById('root');
    if (root) {
      if (root.innerHTML.trim().length > 0) {
        addResult('‚úÖ React Mounted', 'pass',
          `React has rendered content (${root.innerHTML.length} chars)`,
          'App is working correctly!');
      } else {
        addResult('‚ùå React Not Mounted', 'fail',
          'Root element is empty - React has not mounted',
          'Check console for errors. This could be:\n1. Script not loading (wrong HTML served)\n2. Runtime error in React app\n3. Chunk loading failure');
      }
    } else {
      addResult('‚ùå Root Element', 'fail',
        'No #root element found - HTML structure is wrong');
    }
    
    // Check 4: Console logs (if available)
    const hasConsoleLogs = window.console && typeof window.console.log === 'function';
    if (hasConsoleLogs) {
      addResult('‚ÑπÔ∏è Next Steps', 'warning',
        'Open DevTools Console and check for:',
        `[main.tsx] ========== STARTING RENDER ==========\n[App] ========== APP COMPONENT RENDERING ==========\n\nIf you see these logs: React is running (check for runtime errors)\nIf you DON'T see these logs: Script is not loading (wrong HTML served)`);
    }
    
    // Instructions
    addResult('üìã Action Required', 'warning',
      'If any checks failed, configure Spark settings:',
      `1. Build Command: npm install && npm run build
2. Publish Directory: dist
3. Entry HTML: dist/index.html

See SPARK_CONFIGURATION_CHECKLIST.md for detailed instructions.`);
  </script>
</body>
</html>

